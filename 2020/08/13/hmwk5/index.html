<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>hmwk5 - Jian CUI Ph.D.</title><link rel="icon" type="image/png" href=favicon.ico /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="hmwk5" />
<meta property="og:description" content="1. Obtain the data and read it into a data frameAfter skimming the file, I have got two strategies to read the file into a data frame.
From the file, the none data parts are labeled with “!”, such as below links [1:3], so to get rid of these parts, the remaining are the data requested.
I used. Before and after the data part, two sentences are containing “matrix_table_begin/end” (following lines [5:6])." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/2020/08/13/hmwk5/" />
<meta property="article:published_time" content="2020-08-13T13:54:25-04:00" />
<meta property="article:modified_time" content="2020-08-13T13:54:25-04:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="hmwk5"/>
<meta name="twitter:description" content="1. Obtain the data and read it into a data frameAfter skimming the file, I have got two strategies to read the file into a data frame.
From the file, the none data parts are labeled with “!”, such as below links [1:3], so to get rid of these parts, the remaining are the data requested.
I used. Before and after the data part, two sentences are containing “matrix_table_begin/end” (following lines [5:6])."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" /><link rel="stylesheet" type="text/css" href="/css/dark.css"  />

	<script src="/js/feather.min.js"></script>
	
	<script src="/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="/">
	<h1 class="site-title"><a href="/">Jian CUI Ph.D.</a></h1>
	<div class="site-description"><h2>Postdoctoral associate @ <a href="https://upddi.pitt.edu/">Drug Discovery Institute - University of Pittsburgh</a></h2><nav class="nav social">
			<ul class="flat"><a href="mailto:cuij@pitt.edu" title="Email"><i data-feather="mail"></i></a><a href="https://github.com/NaijIuc" title="Github"><i data-feather="github"></i></a><a href="https://www.linkedin.com/in/jian-cui-61ab121b0/" title="LinkedIn"><i data-feather="linkedin"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">hmwk5</h1>
			<div class="meta">Posted at &mdash; Aug 13, 2020</div>
		</div>

		<div class="markdown">
			
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="obtain-the-data-and-read-it-into-a-data-frame" class="section level5">
<h5>1. Obtain the data and read it into a data frame</h5>
<p>After skimming the file, I have got two strategies to read the file into a data frame.</p>
<ol style="list-style-type: decimal">
<li><p>From the file, the none data parts are labeled with “!”, such as below links [1:3], so to get rid of these parts, the remaining are the data requested.</p></li>
<li><p><strong>I used</strong>. Before and after the data part, two sentences are containing <em>“matrix_table_begin/end”</em> (following lines [5:6]). Therefore, I just need to read the information between these two sentences and make it into a data frame.</p></li>
</ol>
<pre class="r"><code>df &lt;- readLines(&quot;https://ftp.ncbi.nlm.nih.gov/geo/series/GSE2nnn/GSE2583/suppl/GSE2583_correctly_ordered_Klevecz_GEO_time_series_data.txt&quot;)

df[c(1:3,56:59)]</code></pre>
<pre><code>  [1] &quot;!Series_title\tGenome_Wide_Oscillations_in_Yeast&quot;                                                                                                                                                                                                                                                       
  [2] &quot;!Series_geo_accession\tGSE2583&quot;                                                                                                                                                                                                                                                                         
  [3] &quot;!Series_status\tPublic on Apr 29 2005&quot;                                                                                                                                                                                                                                                                  
  [4] &quot;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!series_matrix_table_begin&quot;                                                                                                                                                                                                                                            
  [5] &quot;GSM48136\tGSM48137\tGSM48138\tGSM48139\tGSM48140\tGSM48131\tGSM48132\tGSM48133\tGSM48134\tGSM48135\tGSM48149\tGSM48150\tGSM48141\tGSM48151\tGSM48142\tGSM48143\tGSM48144\tGSM48145\tGSM48146\tGSM48147\tGSM48148\tGSM48160\tGSM48161\tGSM48162\tGSM48157\tGSM48158\tGSM48152\tGSM48159\tGSM48153\tGSM48154\tGSM48155\tGSM48156\tID_REF&quot;
  [6] &quot;5.8\t7.9\t5.8\t8.7\t10.7\t6.8\t3\t19.8\t1.1\t2.1\t0.6\t7\t4.8\t4.4\t6.7\t8.8\t8.6\t8.2\t10.2\t5.1\t7.5\t8\t6.8\t2.6\t4.3\t9.5\t9.5\t9.1\t6\t5.4\t8.6\t13.8\t10000_at&quot;                                                                                                                                                                  
  [7] &quot;175.2\t218.2\t379.3\t448.9\t470.4\t375.6\t363\t443.7\t304.4\t289.3\t186.5\t260.6\t216\t211.2\t266.6\t335\t366\t377.9\t296.8\t405.9\t342\t295.4\t322.1\t232\t278.7\t261.8\t386.2\t430.3\t331.9\t453.4\t348.8\t228.3\t10001_at&quot;</code></pre>
<pre class="r"><code>t &lt;- grep(&#39;matrix_table&#39;,df) # locate the position of the two sentences
read_start &lt;- t[1] + 1 # reservation starts
read_end &lt;- t[2] - 1 # reservation ends

df &lt;- df[read_start:read_end] # keep the data part
df &lt;- as.character(unlist(strsplit(df, &quot;\t&quot;))) # Breaking strings with &quot;\t&quot;   
df &lt;- matrix(df,nrow=33) # Employing all broken strings to form a matrix
df &lt;- data.frame(t(df), stringsAsFactors = F) # Removing factor characteristic of all the strings

# Assigning row/column names to the data frame, and removing the corresponding content
rownames(df) &lt;- df[,33] 
colnames(df) &lt;- df[1,]

df &lt;- df[,-33]
df &lt;- df[-1,]

# Transferring a string data frame to a numeric data frame
df.rownames &lt;- row.names(df)
df &lt;- data.frame(sapply(df, as.numeric))
rownames(df) &lt;- df.rownames
rm(df.rownames)

# Checking the data frame 
head(df[c(1:7)])</code></pre>
<pre><code>             GSM48136 GSM48137 GSM48138 GSM48139 GSM48140 GSM48131 GSM48132
  10000_at        5.8      7.9      5.8      8.7     10.7      6.8      3.0
  10001_at      175.2    218.2    379.3    448.9    470.4    375.6    363.0
  10002_i_at   1317.7   1388.5   1886.5   1967.7   1489.0   1321.5   1246.6
  10003_f_at   2920.1   3637.7   3729.1   3368.9   3175.5   2258.2   2703.8
  10004_at        6.0      5.6      5.6     10.3     12.0      7.3     10.9
  10005_at      110.1    106.3    128.7    141.4    128.0    134.3    140.2</code></pre>
</div>
<div id="filter-the-data" class="section level5">
<h5>2. Filter the data</h5>
<p>remove NAN values</p>
<pre class="r"><code>dim(df) # row number and column number checking</code></pre>
<pre><code>  [1] 9335   32</code></pre>
<pre class="r"><code>df &lt;- na.omit(df)

dim(df) </code></pre>
<pre><code>  [1] 9335   32</code></pre>
<p>Comparing before and after NAN trimming, basically, there are no NAN values in the data frame</p>
<p>Calculate the variance as well as the coefficient of each row, and then plot the results.</p>
<p>R has its build-in function <em>var()</em> to calculate variance, and by applying this function, I build a function to get the coefficient of variance (CV).</p>
<pre class="r"><code>The_variance &lt;- apply(df, 1, function(x) var(x))
The_coef &lt;- apply(df, 1, function(x) sqrt(var(x))/mean(x))</code></pre>
<p>The ploting results showing like figure 1.</p>
<div class="figure"><span id="fig:unnamed-chunk-4"></span>
<img src="/post/123/2020-09-17-hmwk5_files/figure-html/unnamed-chunk-4-1.png" alt="The histogram of standard deviations (A) and coefficient of variation (B)." width="672" />
<p class="caption">
Figure 1: The histogram of standard deviations (A) and coefficient of variation (B).
</p>
</div>
<p>Is experimental noise independent of absolute magnitude of measurement? <strong>NO</strong></p>
<p>Accroding to above difination, the coefficient of variation can be calculated with the equation:</p>
<p><span class="math display">\[c_{v}=\sqrt{\frac{1}{n-1}\sum_{i=1}^{n}(\frac{x_{i}}{\overline{x}}-1)^2}\]</span></p>
<p>That is to say, the dispersion of obtaining value depends on the ration of measurement value and <em>mean</em> value, which illustrates that the noise is relevant to the absolute measurement value. 500 samples have been randomly chosen to show the relationship among <em>mean, variance</em> and <em>CV</em>. It is obvious to see, with the increase of <em>mean</em> and <em>variance</em> value, the <em>CV</em> value performs a dropping trend. figure 2.</p>
<div class="figure"><span id="fig:unnamed-chunk-5"></span>
<img src="/post/123/2020-09-17-hmwk5_files/figure-html/unnamed-chunk-5-1.png" alt="The relationship among mean (A), variance (B), and CV (C). With the increases of the former two values, CV has an obvious dropping trend." width="672" />
<p class="caption">
Figure 2: The relationship among mean (A), variance (B), and CV (C). With the increases of the former two values, CV has an obvious dropping trend.
</p>
</div>
<p>Get the “cleaned” gene subset</p>
<p>Remove all genes except the 1000 with the greatest variation. This will be your “cleaned” data set.</p>
<pre class="r"><code># Getting the rank of variantion 
var_dc &lt;- The_variance[order(The_variance,decreasing = T)] 
# Keep the top 1000 ranked genes
df_sub &lt;- df[rownames(df) %in% names(var_dc[1:1000]),] </code></pre>
</div>
<div id="normalize" class="section level5">
<h5>3. Normalize</h5>
<p>There is a build-in function <em>scale()</em> in R able to perform the normalization that each row has zero mean and unit variance.</p>
<pre class="r"><code>df_sub_norm &lt;- t(scale(t(df_sub)))</code></pre>
</div>
<div id="perform-svd" class="section level5">
<h5>4. Perform SVD</h5>
<p>There is a build-in function <em>svd()</em> in R able to perform the SVD. I used the defualt setting to perform the SVD analysis. The reustls contain:</p>
<ul>
<li><p>d, a vector containing the singular values of matrix, sorted decreasingly;</p></li>
<li><p>u, a matrix whose columns contain the left singular vectors of matrix;</p></li>
<li><p>v, a matrix whose columns contain the right singular vectors of matrix.</p></li>
</ul>
<p>Following lines are the <em>head(3)</em> of each content.</p>
<pre class="r"><code>SVD &lt;- svd(df_sub_norm,nv = 10)

sapply(SVD, function(x) head(x,3))</code></pre>
<pre><code>  $d
  [1] 118.48558  81.92593  66.60082
  
  $u
              [,1]         [,2]        [,3]        [,4]         [,5]        [,6]
  [1,] -0.04304027 -0.006353485 -0.01459583 -0.01541453 -0.011282744  0.01131837
  [2,] -0.03748085 -0.023539489 -0.02700427 -0.04119835  0.003341666  0.02497109
  [3,] -0.04123084  0.017659101  0.01939728  0.01299182 -0.004927565 -0.02059720
              [,7]         [,8]         [,9]        [,10]        [,11]
  [1,]  0.02275632 -0.040647626  0.020592277 -0.006490895  0.004995996
  [2,] -0.02653252 -0.006999099 -0.008561893  0.010851076  0.017850165
  [3,] -0.02265388 -0.028211474  0.032580841  0.007620668 -0.030752967
             [,12]       [,13]       [,14]        [,15]       [,16]         [,17]
  [1,]  0.01060743  0.02969657  0.04672217  0.014327581 -0.03974401 -0.0110648579
  [2,]  0.01239896  0.02668866 -0.01542638  0.004736708 -0.04615467  0.0172002619
  [3,] -0.07844366 -0.03844251  0.02015508 -0.003874003  0.03056308  0.0004951917
              [,18]       [,19]       [,20]        [,21]         [,22]
  [1,]  0.081637173 0.009329154 0.029928780  0.066109649 -0.0091305398
  [2,] -0.003113847 0.024178453 0.002324817 -0.003263664  0.0007923078
  [3,]  0.052570731 0.056257857 0.005994210 -0.021009165 -0.0346578803
              [,23]       [,24]        [,25]        [,26]       [,27]       [,28]
  [1,]  0.005250766  0.10724004  0.013996044  0.034119440  0.02681534  0.03492123
  [2,] -0.012068090  0.06174799 -0.022041801 -0.036290296  0.01025699 -0.02763194
  [3,]  0.016043173 -0.01157329  0.006672203 -0.002815855 -0.01984480 -0.01403178
              [,29]        [,30]       [,31]      [,32]
  [1,]  0.008846419  0.032576505  0.02557300  0.3358399
  [2,] -0.032234499  0.016739597 -0.02004410 -0.1223772
  [3,]  0.021952472 -0.008327656  0.02247292 -0.2397787
  
  $v
            [,1]        [,2]        [,3]        [,4]        [,5]       [,6]
  [1,] 0.2883994 -0.02005807  0.03129863 -0.29707914  0.10258256 -0.2543174
  [2,] 0.3211742 -0.09510665 -0.07786879 -0.21673446  0.06165098  0.3090448
  [3,] 0.1441622  0.09087043 -0.36695699 -0.03115421 -0.30636478  0.3602698
              [,7]        [,8]        [,9]       [,10]
  [1,]  0.36461293 -0.02555757  0.03918776 -0.01504841
  [2,] -0.04862079  0.01539450 -0.16146637  0.28220363
  [3,] -0.05738003  0.06841796  0.14776190  0.37323728</code></pre>
<p>Plot the dispersion of the singular values (figure 3).</p>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="/post/123/2020-09-17-hmwk5_files/figure-html/unnamed-chunk-9-1.png" alt="The dispersion of singular values" width="672" />
<p class="caption">
Figure 3: The dispersion of singular values
</p>
</div>
<p>Recall that …</p>
<p>The eigenvalues of the covariance matrix are related to the squares of the singular values (figure 4A &amp; 4B). R has a build-in function <em>prcomp()</em> to performs a principal components analysis on the given data matrix and returns the results as an object of class. From the analysis results below, from the forth component we can get 80% of the variance, see the the cumulative variance plot (figure 4C).</p>
<pre class="r"><code>wdbc.pr &lt;- prcomp(df_sub_norm)

cumpro &lt;- cumsum(wdbc.pr$sdev^2 / sum(wdbc.pr$sdev^2))
which(cumpro &gt; 0.8)</code></pre>
<pre><code>##  [1]  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28
## [26] 29 30 31 32</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-11"></span>
<img src="/post/123/2020-09-17-hmwk5_files/figure-html/unnamed-chunk-11-1.png" alt="The plot of the squares of the singular values (A), the plot eigenvalues of the covariance matix (B), and the cumulative variance plot(C)" width="672" />
<p class="caption">
Figure 4: The plot of the squares of the singular values (A), the plot eigenvalues of the covariance matix (B), and the cumulative variance plot(C)
</p>
</div>
<p>Project the data onto the first 3 principal components.(figure 5)</p>
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<img src="/post/123/2020-09-17-hmwk5_files/figure-html/unnamed-chunk-12-1.png" alt="Data distribution on the first 3 principal components, {v(1),v(2)} (A), {v(2),v(3)} (B), {v(1),v(3)} (C), as well as the highlited genes." width="672" />
<p class="caption">
Figure 5: Data distribution on the first 3 principal components, {v(1),v(2)} (A), {v(2),v(3)} (B), {v(1),v(3)} (C), as well as the highlited genes.
</p>
</div>
<p>Pick a gene with high projection onto the first three principal components. Plot its expression across data sets (figure 6).</p>
<div class="figure"><span id="fig:unnamed-chunk-13"></span>
<img src="/post/123/2020-09-17-hmwk5_files/figure-html/unnamed-chunk-13-1.png" alt="The genes with highest projection in the first three principal component" width="672" />
<p class="caption">
Figure 6: The genes with highest projection in the first three principal component
</p>
</div>
</div>

		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/r">R</a></li>
								
								<li><a href="/tags/pittsburgh">Pittsburgh</a></li>
								
								<li><a href="/tags/healthy-ride">Healthy Ride</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © by Jian Cui |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>
